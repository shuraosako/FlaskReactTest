{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\81809\\\\Documents\\\\\\u5B66\\u6821\\\\\\u5352\\u7814\\\\kojitest1\\\\frontend\\\\src\\\\components\\\\Fitnes1.jsx\",\n  _s = $RefreshSig$();\nimport React, { useRef, useEffect, useState } from 'react';\nimport * as posenet from '@tensorflow-models/posenet';\nimport '@tensorflow/tfjs';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst CameraFeed = () => {\n  _s();\n  const videoRef = useRef(null);\n  const canvasRef = useRef(null);\n  const [isCameraOn, setIsCameraOn] = useState(false);\n  const [net, setNet] = useState(null);\n  useEffect(() => {\n    const loadPosenet = async () => {\n      const net = await posenet.load();\n      setNet(net);\n    };\n    loadPosenet();\n  }, []);\n  const startCamera = async () => {\n    try {\n      const stream = await navigator.mediaDevices.getUserMedia({\n        video: true\n      });\n      videoRef.current.srcObject = stream;\n      videoRef.current.onloadedmetadata = () => {\n        videoRef.current.play();\n        setIsCameraOn(true);\n        if (net) {\n          detectPose();\n        }\n      };\n    } catch (err) {\n      console.error(\"Error accessing the camera: \", err);\n      alert(\"カメラへのアクセスが拒否されました。ブラウザの設定を確認してください。\");\n    }\n  };\n  const stopCamera = () => {\n    const stream = videoRef.current.srcObject;\n    if (stream) {\n      const tracks = stream.getTracks();\n      tracks.forEach(track => track.stop());\n      videoRef.current.srcObject = null;\n      setIsCameraOn(false);\n    }\n  };\n  const detectPose = async () => {\n    if (!net) return;\n    const video = videoRef.current;\n    const canvas = canvasRef.current;\n    const ctx = canvas.getContext('2d');\n    canvas.width = video.videoWidth;\n    canvas.height = video.videoHeight;\n    async function poseDetectionFrame() {\n      if (!isCameraOn) return;\n      const pose = await net.estimateSinglePose(video, {\n        flipHorizontal: false\n      });\n      ctx.clearRect(0, 0, canvas.width, canvas.height);\n      ctx.drawImage(video, 0, 0, canvas.width, canvas.height);\n      drawKeypoints(pose['keypoints'], 0.6, ctx);\n      drawSkeleton(pose['keypoints'], 0.7, ctx);\n      requestAnimationFrame(poseDetectionFrame);\n    }\n    poseDetectionFrame();\n  };\n  const drawKeypoints = (keypoints, minConfidence, ctx) => {\n    keypoints.forEach(keypoint => {\n      if (keypoint.score >= minConfidence) {\n        const {\n          y,\n          x\n        } = keypoint.position;\n        ctx.beginPath();\n        ctx.arc(x, y, 5, 0, 2 * 2 * Math.PI);\n        ctx.fillStyle = 'aqua';\n        ctx.fill();\n      }\n    });\n  };\n  const drawSkeleton = (keypoints, minConfidence, ctx) => {\n    const adjacentKeyPoints = posenet.getAdjacentKeyPoints(keypoints, minConfidence);\n    adjacentKeyPoints.forEach(keypoints => {\n      const [from, to] = keypoints;\n      ctx.beginPath();\n      ctx.moveTo(from.position.x, from.position.y);\n      ctx.lineTo(to.position.x, to.position.y);\n      ctx.lineWidth = 2;\n      ctx.strokeStyle = 'aqua';\n      ctx.stroke();\n    });\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"camera-feed\",\n    children: [/*#__PURE__*/_jsxDEV(\"video\", {\n      ref: videoRef,\n      className: isCameraOn ? \"active\" : \"\",\n      style: {\n        display: isCameraOn ? 'block' : 'none'\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 103,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"canvas\", {\n      ref: canvasRef,\n      style: {\n        position: 'absolute',\n        top: 0,\n        left: 0\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 104,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n      className: \"start-button\",\n      onClick: startCamera,\n      children: \"\\u64AE\\u5F71\\u3092\\u958B\\u59CB\\u3059\\u308B\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 105,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n      className: \"stop-button\",\n      onClick: stopCamera,\n      children: \"\\u64AE\\u5F71\\u3092\\u505C\\u6B62\\u3059\\u308B\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 106,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 102,\n    columnNumber: 5\n  }, this);\n};\n_s(CameraFeed, \"H8wyYD9S/Dzh5ef9MMBD5gw+dkk=\");\n_c = CameraFeed;\nexport default CameraFeed;\nvar _c;\n$RefreshReg$(_c, \"CameraFeed\");","map":{"version":3,"names":["React","useRef","useEffect","useState","posenet","jsxDEV","_jsxDEV","CameraFeed","_s","videoRef","canvasRef","isCameraOn","setIsCameraOn","net","setNet","loadPosenet","load","startCamera","stream","navigator","mediaDevices","getUserMedia","video","current","srcObject","onloadedmetadata","play","detectPose","err","console","error","alert","stopCamera","tracks","getTracks","forEach","track","stop","canvas","ctx","getContext","width","videoWidth","height","videoHeight","poseDetectionFrame","pose","estimateSinglePose","flipHorizontal","clearRect","drawImage","drawKeypoints","drawSkeleton","requestAnimationFrame","keypoints","minConfidence","keypoint","score","y","x","position","beginPath","arc","Math","PI","fillStyle","fill","adjacentKeyPoints","getAdjacentKeyPoints","from","to","moveTo","lineTo","lineWidth","strokeStyle","stroke","className","children","ref","style","display","fileName","_jsxFileName","lineNumber","columnNumber","top","left","onClick","_c","$RefreshReg$"],"sources":["C:/Users/81809/Documents/学校/卒研/kojitest1/frontend/src/components/Fitnes1.jsx"],"sourcesContent":["import React, { useRef, useEffect, useState } from 'react';\r\nimport * as posenet from '@tensorflow-models/posenet';\r\nimport '@tensorflow/tfjs';\r\n\r\nconst CameraFeed = () => {\r\n  const videoRef = useRef(null);\r\n  const canvasRef = useRef(null);\r\n  const [isCameraOn, setIsCameraOn] = useState(false);\r\n  const [net, setNet] = useState(null);\r\n\r\n  useEffect(() => {\r\n    const loadPosenet = async () => {\r\n      const net = await posenet.load();\r\n      setNet(net);\r\n    };\r\n    loadPosenet();\r\n  }, []);\r\n\r\n  const startCamera = async () => {\r\n    try {\r\n      const stream = await navigator.mediaDevices.getUserMedia({ video: true });\r\n      videoRef.current.srcObject = stream;\r\n      videoRef.current.onloadedmetadata = () => {\r\n        videoRef.current.play();\r\n        setIsCameraOn(true);\r\n        if (net) {\r\n          detectPose();\r\n        }\r\n      };\r\n    } catch (err) {\r\n      console.error(\"Error accessing the camera: \", err);\r\n      alert(\"カメラへのアクセスが拒否されました。ブラウザの設定を確認してください。\");\r\n    }\r\n  };\r\n\r\n  const stopCamera = () => {\r\n    const stream = videoRef.current.srcObject;\r\n    if (stream) {\r\n      const tracks = stream.getTracks();\r\n      tracks.forEach(track => track.stop());\r\n      videoRef.current.srcObject = null;\r\n      setIsCameraOn(false);\r\n    }\r\n  };\r\n\r\n  const detectPose = async () => {\r\n    if (!net) return;\r\n\r\n    const video = videoRef.current;\r\n    const canvas = canvasRef.current;\r\n    const ctx = canvas.getContext('2d');\r\n\r\n    canvas.width = video.videoWidth;\r\n    canvas.height = video.videoHeight;\r\n\r\n    async function poseDetectionFrame() {\r\n      if (!isCameraOn) return;\r\n\r\n      const pose = await net.estimateSinglePose(video, {\r\n        flipHorizontal: false,\r\n      });\r\n\r\n      ctx.clearRect(0, 0, canvas.width, canvas.height);\r\n      ctx.drawImage(video, 0, 0, canvas.width, canvas.height);\r\n\r\n      drawKeypoints(pose['keypoints'], 0.6, ctx);\r\n      drawSkeleton(pose['keypoints'], 0.7, ctx);\r\n\r\n      requestAnimationFrame(poseDetectionFrame);\r\n    }\r\n\r\n    poseDetectionFrame();\r\n  };\r\n\r\n  const drawKeypoints = (keypoints, minConfidence, ctx) => {\r\n    keypoints.forEach(keypoint => {\r\n      if (keypoint.score >= minConfidence) {\r\n        const { y, x } = keypoint.position;\r\n        ctx.beginPath();\r\n        ctx.arc(x, y, 5, 0, 2 * 2 * Math.PI);\r\n        ctx.fillStyle = 'aqua';\r\n        ctx.fill();\r\n      }\r\n    });\r\n  };\r\n\r\n  const drawSkeleton = (keypoints, minConfidence, ctx) => {\r\n    const adjacentKeyPoints = posenet.getAdjacentKeyPoints(keypoints, minConfidence);\r\n\r\n    adjacentKeyPoints.forEach(keypoints => {\r\n      const [from, to] = keypoints;\r\n      ctx.beginPath();\r\n      ctx.moveTo(from.position.x, from.position.y);\r\n      ctx.lineTo(to.position.x, to.position.y);\r\n      ctx.lineWidth = 2;\r\n      ctx.strokeStyle = 'aqua';\r\n      ctx.stroke();\r\n    });\r\n  };\r\n\r\n  return (\r\n    <div className=\"camera-feed\">\r\n      <video ref={videoRef} className={isCameraOn ? \"active\" : \"\"} style={{ display: isCameraOn ? 'block' : 'none' }} />\r\n      <canvas ref={canvasRef} style={{ position: 'absolute', top: 0, left: 0 }} />\r\n      <button className=\"start-button\" onClick={startCamera}>撮影を開始する</button>\r\n      <button className=\"stop-button\" onClick={stopCamera}>撮影を停止する</button>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default CameraFeed;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}